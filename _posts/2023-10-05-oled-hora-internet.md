---
title: Hora obtenida de internet en display OLED (SSD1306) 
author: omar
date: 2023-10-05 05:00:00 -0800
categories: [Practica]
tags: [display,raspberry pi,pico w,micropython]     # TAG names should always be lowercase
img_path: /assets/img/oled-hora-internet/
---

## Resultados de la practica

![Display monstrando la hora actual de Tijuana](practica.jpg)

## Código en Micropython

Se utilizó la libreria [`micropython-ssd1306`](https://github.com/stlehmann/micropython-ssd1306/tree/master)
para realizar la conexión entre la Pico W y el display OLED SSD1306.

```python
import time

import framebuf
import time_images
from machine import I2C, Pin
from ssd1306 import SSD1306_I2C

WIDTH = 128
HEIGHT = 64


def display_text(oled):
    oled.text("Horario de", 5, 0)
    oled.text("America/Tijuana", 5, 10)


def time_format(hour, minutes):
    f_hour = hour % 12 if hour != 12 else hour
    f_hour = ("0" + str(f_hour)) if f_hour < 10 else f_hour
    f_minutes = ("0" + str(minutes)) if minutes < 10 else minutes
    meridiem = "AM" if hour < 12 else "PM"
    return f"{f_hour}:{f_minutes} {meridiem}"


def match_image_time(hour):
    if 6 <= hour < 12:
        image = time_images.MORNING
    elif 12 <= hour < 20:
        image = time_images.EVENING
    elif (20 <= hour <= 24) or (0 <= hour < 6):
        image = time_images.NIGHT
    else:
        raise ValueError("Hour off limits")
    return framebuf.FrameBuffer(image, 30, 30, framebuf.MONO_HLSB)


def display_time(oled, DEBUG=False):
    last_hour = -1
    last_image = bytearray()
    x_center = (WIDTH - 30) // 2
    # oled.fillrect(x, y, width, height, color)
    text_cover = 5, 20, oled.width - 5, 8, 0

    while True:
        localtime = time.localtime()
        hour, minutes = localtime[3:5]
        oled.fill_rect(*text_cover)
        oled.text(time_format(hour, minutes), 5, 20)

        if hour != last_hour:
            image = match_image_time(hour)
            last_hour = hour
            if image != last_image:
                oled.blit(image, x_center, 30)
                last_image = image

        oled.show()
        if DEBUG:
            print("Local Time:", localtime)
        time.sleep(1)


def main():
    i2c = I2C(0, scl=Pin(21), sda=Pin(20), freq=200000)
    oled = SSD1306_I2C(WIDTH, HEIGHT, i2c)

    display_text(oled)
    display_time(oled)


if __name__ == "__main__":
    main()
```
{: file="main.py" }

```python
MORNING = bytearray(
    [
        # 'sun', 30x30px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 
        0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x03, 0x00, 0x03, 0x00, 0x03, 0x80, 0x07, 0x00, 
        0x01, 0x83, 0x06, 0x00, 0x00, 0x1f, 0xe0, 0x00, 0x00, 0x3c, 0xf0, 0x00, 0x00, 0x70, 0x38, 0x00, 
        0x00, 0x60, 0x18, 0x00, 0x00, 0x60, 0x18, 0x00, 0x1c, 0xc0, 0x0c, 0xe0, 0x1c, 0xc0, 0x0c, 0xe0, 
        0x00, 0x60, 0x18, 0x00, 0x00, 0x60, 0x18, 0x00, 0x00, 0x70, 0x38, 0x00, 0x00, 0x3c, 0xf0, 0x00, 
        0x00, 0x1f, 0xe0, 0x00, 0x01, 0x83, 0x06, 0x00, 0x03, 0x80, 0x07, 0x00, 0x03, 0x00, 0x03, 0x00, 
        0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    ]
)

EVENING = bytearray(
    [
        # 'evening', 30x30px
        0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 
        0x07, 0x03, 0x03, 0x80, 0x03, 0x80, 0x07, 0x00, 0x01, 0xc0, 0x0e, 0x00, 0x00, 0xcf, 0xcc, 0x00, 
        0x00, 0x1f, 0xe0, 0x00, 0x00, 0x38, 0x70, 0x00, 0x00, 0x70, 0x38, 0x00, 0x00, 0x60, 0x18, 0x00, 
        0xff, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 
        0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 
        0x00, 0x03, 0x00, 0x00, 0x00, 0x3b, 0x70, 0x00, 0x00, 0x1f, 0xe0, 0x00, 0x00, 0x0f, 0xc0, 0x00, 
        0x00, 0x07, 0x80, 0x00, 0x00, 0x03, 0x00, 0x00
    ]
)

NIGHT = bytearray(
    [
        # 'moon', 30x30px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 
        0x01, 0xe0, 0x00, 0x00, 0x03, 0xe0, 0x00, 0x00, 0x03, 0xe0, 0x00, 0x00, 0x07, 0xe0, 0x00, 0x00, 
        0x07, 0xf0, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x07, 0xf8, 0x00, 0x00, 0x07, 0xf8, 0x00, 0x00, 
        0x07, 0xfc, 0x00, 0x00, 0x07, 0xff, 0x00, 0x00, 0x03, 0xff, 0xc1, 0x80, 0x03, 0xff, 0xff, 0x00, 
        0x01, 0xff, 0xff, 0x00, 0x01, 0xff, 0xfe, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x3f, 0xf8, 0x00, 
        0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    ]
)
```
{: file="time_images.py" }
